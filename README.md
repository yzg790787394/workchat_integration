
# Home Assistant ä¼å¾®é€šé›†æˆ

[](https://github.com/yzg790787394/workchat_integration/releases)
[](https://github.com/yzg790787394/workchat_integration/blob/main/LICENSE)
[](https://github.com/hacs/integration)

ä¼å¾®é€šé›†æˆå…è®¸Home Assistantä¸ä¼ä¸šå¾®ä¿¡ï¼ˆWorkChatï¼‰æ— ç¼é›†æˆï¼Œå®ç°åŒå‘é€šä¿¡åŠŸèƒ½ã€‚é€šè¿‡æ­¤é›†æˆï¼Œæ‚¨å¯ä»¥ï¼š

1. ğŸ“¨ ä»Home Assistantå‘ä¼ä¸šå¾®ä¿¡å‘é€å„ç§ç±»å‹çš„æ¶ˆæ¯ï¼ˆæ–‡æœ¬ã€å›¾ç‰‡ã€æ–‡ä»¶ã€å¡ç‰‡ç­‰ï¼‰
2. ğŸ“¥ æ¥æ”¶ä¼ä¸šå¾®ä¿¡å‘é€çš„æ¶ˆæ¯ï¼ˆæ–‡æœ¬ã€å›¾ç‰‡ã€ä½ç½®ç­‰ï¼‰
3. ğŸ“Š åœ¨Home Assistantä¸­å±•ç¤ºæ¥æ”¶çš„æ¶ˆæ¯å†…å®¹å’Œå›è°ƒä¿¡æ¯

## ğŸŒŸ åŠŸèƒ½æ¦‚è§ˆ

- ğŸ“¨ **æ¶ˆæ¯å‘é€**ï¼šæ”¯æŒå¤šç§æ¶ˆæ¯ç±»å‹å‘é€åˆ°ä¼ä¸šå¾®ä¿¡
- ğŸ“¤ **æ–‡ä»¶ä¸Šä¼ **ï¼šä¸Šä¼ åª’ä½“æ–‡ä»¶åˆ°ä¼ä¸šå¾®ä¿¡æœåŠ¡å™¨
- ğŸ”„ **åŒå‘é€šä¿¡**ï¼šæ¥æ”¶ä¼ä¸šå¾®ä¿¡çš„æ¶ˆæ¯å›è°ƒå¹¶å¤„ç†
- ğŸ“Š **ä¼ æ„Ÿå™¨é›†æˆ**ï¼šå°†æ¥æ”¶çš„æ¶ˆæ¯å’ŒçŠ¶æ€å±•ç¤ºä¸ºä¼ æ„Ÿå™¨å®ä½“
- ğŸ” **å®‰å…¨éªŒè¯**ï¼šæ”¯æŒä¼ä¸šå¾®ä¿¡çš„å®‰å…¨éªŒè¯æœºåˆ¶

## ğŸ“¦ å®‰è£…

### é€šè¿‡HACSå®‰è£…ï¼ˆæ¨èï¼‰

1. åœ¨HACSçš„"é›†æˆ"éƒ¨åˆ†ï¼Œç‚¹å‡»å³ä¸Šè§’çš„ä¸‰ç‚¹èœå•
2. é€‰æ‹©"è‡ªå®šä¹‰å­˜å‚¨åº“"
3. åœ¨å­˜å‚¨åº“å­—æ®µè¾“å…¥ï¼š`https://github.com/yzg790787394/workchat_integration`
4. ç±»åˆ«é€‰æ‹©"é›†æˆ"
5. ç‚¹å‡»"æ·»åŠ "ä¿å­˜
6. åœ¨HACSä¸­æ‰¾åˆ°"ä¼å¾®é€š"é›†æˆå¹¶ç‚¹å‡»å®‰è£…
7. é‡å¯Home Assistant

### æ‰‹åŠ¨å®‰è£…

1. ä¸‹è½½æœ€æ–°çš„[å‘å¸ƒç‰ˆæœ¬](https://github.com/yzg790787394/workchat_integration/releases)
2. è§£å‹å¹¶å°†`workchat_integration`æ–‡ä»¶å¤¹æ”¾å…¥Home Assistantçš„`custom_components`ç›®å½•
3. é‡å¯Home Assistant

## âš™ï¸ é…ç½®

### æ­¥éª¤1ï¼šè·å–ä¼ä¸šå¾®ä¿¡å‚æ•°

åœ¨å¼€å§‹é…ç½®å‰ï¼Œæ‚¨éœ€è¦ä»ä¼ä¸šå¾®ä¿¡ç®¡ç†åå°è·å–ä»¥ä¸‹ä¿¡æ¯ï¼š

1. **ä¼ä¸šID(Corp ID)**ï¼šä¼ä¸šå¾®ä¿¡çš„å”¯ä¸€æ ‡è¯†
2. **åº”ç”¨Secret**ï¼šä¼ä¸šå¾®ä¿¡åº”ç”¨çš„å¯†é’¥
3. **åº”ç”¨Agent ID**ï¼šä¼ä¸šå¾®ä¿¡åº”ç”¨çš„ID
4. **Token**ï¼šç”¨äºå›è°ƒéªŒè¯çš„ä»¤ç‰Œ
5. **EncodingAESKey**ï¼šç”¨äºæ¶ˆæ¯åŠ å¯†çš„å¯†é’¥

### æ­¥éª¤2ï¼šåœ¨Home Assistantä¸­æ·»åŠ é›†æˆ

1. è¿›å…¥Home Assistantçš„ **è®¾ç½®** > **è®¾å¤‡ä¸æœåŠ¡** > **é›†æˆ**
2. ç‚¹å‡»å³ä¸‹è§’çš„ **+ æ·»åŠ é›†æˆ**
3. æœç´¢å¹¶é€‰æ‹© **"ä¼å¾®é€š"**
4. å¡«å†™ä»¥ä¸‹é…ç½®å‚æ•°ï¼š
   - **ä¼ä¸šID**ï¼šæ‚¨çš„ä¼ä¸šID
   - **åº”ç”¨Secret**ï¼šåº”ç”¨çš„å¯†é’¥
   - **åº”ç”¨Agent ID**ï¼šåº”ç”¨çš„ID
   - **Token**ï¼šå›è°ƒéªŒè¯ä»¤ç‰Œ
   - **EncodingAESKey**ï¼šåŠ å¯†å¯†é’¥
   - **æ¥æ”¶ç”¨æˆ·**ï¼šé»˜è®¤æ¥æ”¶æ¶ˆæ¯çš„ç”¨æˆ·ï¼ˆå¦‚`@all`æˆ–æŒ‡å®šç”¨æˆ·IDï¼‰
   - **å¤–éƒ¨URL**ï¼šHome Assistantçš„å¤–éƒ¨è®¿é—®åœ°å€ï¼ˆè‡ªåŠ¨å¡«å……ï¼‰
5. ç‚¹å‡» **æäº¤** å®Œæˆé…ç½®

### æ­¥éª¤3ï¼šè®¾ç½®ä¼ä¸šå¾®ä¿¡å›è°ƒ

é…ç½®å®Œæˆåï¼Œæ‚¨éœ€è¦å°†å›è°ƒURLè®¾ç½®åˆ°ä¼ä¸šå¾®ä¿¡åå°ï¼š

1. åœ¨é›†æˆé…ç½®å®Œæˆåï¼Œæ£€æŸ¥æ—¥å¿—ä¸­æ˜¾ç¤ºçš„å›è°ƒURLï¼ˆæ ¼å¼å¦‚ï¼š`https://your-ha-domain/api/workchat_callback/your_token`ï¼‰
2. ç™»å½•ä¼ä¸šå¾®ä¿¡ç®¡ç†åå°
3. è¿›å…¥"åº”ç”¨ç®¡ç†" > é€‰æ‹©æ‚¨çš„åº”ç”¨ > "æ¥æ”¶æ¶ˆæ¯"
4. ç‚¹å‡»"è®¾ç½®APIæ¥æ”¶"
5. å¡«å…¥ä»¥ä¸‹ä¿¡æ¯ï¼š
   - **URL**ï¼šHome Assistantä¸­æ˜¾ç¤ºçš„å›è°ƒURL
   - **Token**ï¼šä¸é…ç½®ä¸­ç›¸åŒçš„Token
   - **EncodingAESKey**ï¼šä¸é…ç½®ä¸­ç›¸åŒçš„EncodingAESKey
6. ä¿å­˜è®¾ç½®å¹¶å¯ç”¨

## ğŸš€ æœåŠ¡ä½¿ç”¨

### 1. æ¶ˆæ¯é€šçŸ¥æœåŠ¡

é€šè¿‡`workchat_integration.notify`æœåŠ¡å‘é€æ¶ˆæ¯åˆ°ä¼ä¸šå¾®ä¿¡ã€‚

#### åŸºæœ¬ç”¨æ³•

```
yaml
service: workchat_integration.notify
  data:
  msg_type: text
  message: "ä¼ æ„Ÿå™¨çŠ¶æ€å¼‚å¸¸ï¼"
```


#### å®Œæ•´å‚æ•°

| å‚æ•° | å¿…å¡« | ç±»å‹ | é»˜è®¤å€¼ | æè¿° |
|------|------|------|--------|------|
| `msg_type` | æ˜¯ | string | "text" | æ¶ˆæ¯ç±»å‹ï¼štext, image, video, file, textcard, news |
| `message` | æ˜¯ | string | - | æ¶ˆæ¯åŸºç¡€å†…å®¹ï¼ˆæ–‡æœ¬/æè¿°ï¼‰ |
| `title` | å¦ | string | - | æ¶ˆæ¯æ ‡é¢˜ï¼ˆç”¨äºå¡ç‰‡ã€è§†é¢‘å’Œå›¾æ–‡æ¶ˆæ¯ï¼‰ |
| `media_id` | éƒ¨åˆ†ç±»å‹å¿…å¡« | string | - | åª’ä½“æ–‡ä»¶IDï¼ˆéœ€å…ˆä¸Šä¼ ï¼‰ |
| `url` | éƒ¨åˆ†ç±»å‹å¿…å¡« | string | - | é“¾æ¥åœ°å€ï¼ˆå¡ç‰‡è·³è½¬/å›¾æ–‡URLï¼‰ |
| `btntxt` | å¦ | string | "è¯¦æƒ…" | å¡ç‰‡æ¶ˆæ¯æŒ‰é’®æ–‡å­— |
| `articles` | å›¾æ–‡æ¶ˆæ¯å¿…å¡« | list | - | å›¾æ–‡æ¶ˆæ¯çš„å¤šç¯‡æ–‡ç« ï¼ˆYAMLæ ¼å¼ï¼‰ |
| `touser` | å¦ | string | é…ç½®å€¼ | æŒ‡å®šæ¥æ”¶ç”¨æˆ·ï¼ˆ@allæˆ–ç”¨æˆ·IDï¼‰ |

#### æ¶ˆæ¯ç±»å‹ç¤ºä¾‹

**æ–‡æœ¬æ¶ˆæ¯**
```
yaml

service: workchat_integration.notify
  data:
  msg_type: text
  message: "å®¢å…æ¸©åº¦è¿‡é«˜ï¼å½“å‰æ¸©åº¦: {{ states('sensor.living_room_temperature') }}â„ƒ"

```
**å›¾ç‰‡æ¶ˆæ¯**
```
yaml

service: workchat_integration.notify
  data:
  msg_type: image
  media_id: "1Yv-zXfHjSjU-7LH-GwtYqDGS"
  message: "å®¢å…ç›‘æ§æˆªå›¾"

```
**å¡ç‰‡æ¶ˆæ¯**
```
yaml

service: workchat_integration.notify
  data:
  msg_type: textcard
  title: "å®‰é˜²é€šçŸ¥"
  message: "å‰é—¨æ£€æµ‹åˆ°æœ‰äººæ´»åŠ¨"
  url: ""https://your-ha-domain/lovelace/security" (https://your-ha-domain/lovelace/security)"
  btntxt: "æŸ¥çœ‹è¯¦æƒ…"

```
**å›¾æ–‡æ¶ˆæ¯**
```
yaml

service: workchat_integration.notify
  data:
  msg_type: news
  articles:
  - title: "å¤©æ°”é¢„è­¦"description: "ä»Šæ—¥å°†æœ‰æš´é›¨ï¼Œè¯·å…³å¥½é—¨çª—"url: ""https://weather.com" (https://weather.com)"picurl: ""https://example.com/weather.jpg" (https://example.com/weather.jpg)"
  - title: "è®¾å¤‡çŠ¶æ€"description: "æ‰€æœ‰è®¾å¤‡è¿è¡Œæ­£å¸¸"url: ""https://your-ha-domain/lovelace/devices" (https://your-ha-domain/lovelace/devices)"
```
### 2. åª’ä½“ä¸Šä¼ æœåŠ¡

ä½¿ç”¨`workchat_integration.upload_media`æœåŠ¡ä¸Šä¼ æ–‡ä»¶åˆ°ä¼ä¸šå¾®ä¿¡å¹¶è·å–media_idã€‚

#### åŸºæœ¬ç”¨æ³•
```
yaml

service: workchat_integration.upload_media
  data:
  file_path: "/config/www/snapshot.jpg"

```
#### å®Œæ•´å‚æ•°

| å‚æ•° | å¿…å¡« | ç±»å‹ | é»˜è®¤å€¼ | æè¿° |
|------|------|------|--------|------|
| `type` | å¦ | string | "file" | åª’ä½“ç±»å‹ï¼šfile, image, video, voice |
| `file_path` | æ˜¯ | string | - | æœ¬åœ°æ–‡ä»¶å®Œæ•´è·¯å¾„ |
| `file_name` | å¦ | string | è‡ªåŠ¨è·å– | è‡ªå®šä¹‰æ–‡ä»¶å |

#### ä¸Šä¼ ç¤ºä¾‹
```
yaml

service: workchat_integration.upload_media
  data:
  type: image
  file_path: "/config/www/living_room_snapshot.jpg"
  file_name: "living_room.jpg"

```
#### å“åº”ç¤ºä¾‹

æœåŠ¡è°ƒç”¨æˆåŠŸåä¼šè¿”å›media_idï¼š
```
json

{

"media_id": "2hY-zXfHjSjU-8LH-GwtYqDHT"

}

```
## ğŸ” ä¼ æ„Ÿå™¨

é›†æˆæ·»åŠ åä¼šè‡ªåŠ¨åˆ›å»ºä»¥ä¸‹ä¼ æ„Ÿå™¨å®ä½“ï¼š

### 1. ä¼å¾®é€šæ–‡æœ¬æ¶ˆæ¯ä¼ æ„Ÿå™¨
- **çŠ¶æ€**ï¼šæœ€æ–°æ”¶åˆ°çš„æ–‡æœ¬å†…å®¹
- **å±æ€§**ï¼š
  - ç”¨æˆ·ï¼šå‘é€æ¶ˆæ¯çš„ç”¨æˆ·ID
  - æ—¶é—´ï¼šæ¶ˆæ¯æ—¶é—´æˆ³
  - å†…å®¹ï¼šå®Œæ•´æ¶ˆæ¯å†…å®¹

### 2. ä¼å¾®é€šå›¾ç‰‡æ¶ˆæ¯ä¼ æ„Ÿå™¨
- **çŠ¶æ€**ï¼šåª’ä½“æ–‡ä»¶ID
- **å±æ€§**ï¼š
  - ç”¨æˆ·ï¼šå‘é€æ¶ˆæ¯çš„ç”¨æˆ·ID
  - æ—¶é—´ï¼šæ¶ˆæ¯æ—¶é—´æˆ³
  - å›¾ç‰‡URLï¼šå›¾ç‰‡è®¿é—®åœ°å€
  - åª’ä½“IDï¼šåª’ä½“æ–‡ä»¶ID

### 3. ä¼å¾®é€šä½ç½®æ¶ˆæ¯ä¼ æ„Ÿå™¨
- **çŠ¶æ€**ï¼šä½ç½®æ ‡ç­¾
- **å±æ€§**ï¼š
  - ç”¨æˆ·ï¼šå‘é€æ¶ˆæ¯çš„ç”¨æˆ·ID
  - æ—¶é—´ï¼šæ¶ˆæ¯æ—¶é—´æˆ³
  - çº¬åº¦ï¼šä½ç½®çº¬åº¦
  - ç»åº¦ï¼šä½ç½®ç»åº¦
  - ç¼©æ”¾çº§åˆ«ï¼šåœ°å›¾ç¼©æ”¾æ¯”ä¾‹
  - ä½ç½®æ ‡ç­¾ï¼šä½ç½®æè¿°

### 4. ä¼å¾®é€šå›è°ƒURLä¿¡æ¯ä¼ æ„Ÿå™¨
- **çŠ¶æ€**ï¼šé…ç½®çŠ¶æ€
- **å±æ€§**ï¼š
  - å›è°ƒURLï¼šç”¨äºä¼ä¸šå¾®ä¿¡çš„å›è°ƒåœ°å€
  - Tokenï¼šéªŒè¯ä»¤ç‰Œ
  - EncodingAESKeyï¼šåŠ å¯†å¯†é’¥

### 5. ä¼å¾®é€šä¸Šä¼ åª’ä½“æ–‡ä»¶ä¿¡æ¯ä¼ æ„Ÿå™¨
- **çŠ¶æ€**ï¼šä¸Šä¼ çŠ¶æ€
- **å±æ€§**ï¼š
  - æ–‡ä»¶åï¼šä¸Šä¼ çš„æ–‡ä»¶å
  - æ–‡ä»¶ç±»å‹ï¼šåª’ä½“ç±»å‹
  - ä¸Šä¼ æ—¶é—´ï¼šä¸Šä¼ å®Œæˆæ—¶é—´
  - æ–‡ä»¶è·¯å¾„ï¼šæœ¬åœ°æ–‡ä»¶è·¯å¾„
  - media_idï¼šä¸Šä¼ åè·å¾—çš„åª’ä½“ID

## âš¡ é«˜çº§åŠŸèƒ½

### è‡ªåŠ¨åŒ–ç¤ºä¾‹

**å½“æ¸©åº¦è¿‡é«˜æ—¶å‘é€é€šçŸ¥**
```
yaml

alias: é«˜æ¸©æŠ¥è­¦é€šçŸ¥

trigger:

  - platform: numeric_stateentity_id: sensor.living_room_temperatureabove: 30action:
  - service: workchat_integration.notifydata:msg_type: textcardtitle: "é«˜æ¸©è­¦å‘Š"message: >å®¢å…æ¸©åº¦è¿‡é«˜ï¼å½“å‰æ¸©åº¦: {{ states('sensor.living_room_temperature') }}â„ƒå»ºè®®æ‰“å¼€ç©ºè°ƒurl: ""https://your-ha-domain/lovelace/climate" (https://your-ha-domain/lovelace/climate)"btntxt: "è°ƒæ•´ç©ºè°ƒ"
```
**æ¥æ”¶ä½ç½®æ¶ˆæ¯æ—¶æ›´æ–°è®¾å¤‡è¿½è¸ªå™¨**
```
yaml

alias: æ›´æ–°ä½ç½®è¿½è¸ª
trigger:
  - platform: eventevent_type: workchat_messageevent_data:type: locationaction:
  - service: device_tracker.seedata:dev_id: mobile_app_workchatlocation_name: "{{ trigger.event.data.label }}"gps:
   - "{{ trigger.event.data.lat }}"
   - "{{ trigger.event.data.lon }}"
```
## ğŸ›  æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **å›è°ƒéªŒè¯å¤±è´¥**
- 

æ£€æŸ¥ä¼ä¸šå¾®ä¿¡åå°çš„å›è°ƒURLã€Tokenå’ŒEncodingAESKeyæ˜¯å¦ä¸Home Assistanté…ç½®ä¸€è‡´

- ç¡®ä¿Home Assistantçš„å¤–éƒ¨URLå¯å…¬å¼€è®¿é—®
- æ£€æŸ¥ç³»ç»Ÿæ—¶é—´æ˜¯å¦å‡†ç¡®ï¼ˆæ—¶é—´åå·®ä¼šå¯¼è‡´ç­¾åé”™è¯¯ï¼‰

2. æ¶ˆæ¯å‘é€å¤±è´¥
   - æ£€æŸ¥ä¼ä¸šå¾®ä¿¡åº”ç”¨çš„æƒé™è®¾ç½®
   - éªŒè¯æ¥æ”¶ç”¨æˆ·IDæ˜¯å¦æ­£ç¡®
   - ç¡®è®¤åª’ä½“æ–‡ä»¶å·²æ­£ç¡®ä¸Šä¼ ä¸”media_idæœ‰æ•ˆ
   - æ£€æŸ¥æ—¥å¿—è·å–è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
3. æ–‡ä»¶ä¸Šä¼ å¤±è´¥
   - ç¡®ä¿æ–‡ä»¶è·¯å¾„æ­£ç¡®ä¸”æœ‰è®¿é—®æƒé™
   - æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼ˆä¼ä¸šå¾®ä¿¡é™åˆ¶ä¸º10MBï¼‰
   - ç¡®è®¤ç½‘ç»œè¿æ¥æ­£å¸¸

æ—¥å¿—åˆ†æ

åœ¨Home Assistantçš„
"configuration.yaml"ä¸­å¢åŠ æ—¥å¿—çº§åˆ«è®¾ç½®ï¼š
```
logger:
  default: info
  logs:
    custom_components.workchat_integration: debug
```
é‡å¯åæŸ¥çœ‹æ—¥å¿—è·å–è¯¦ç»†è°ƒè¯•ä¿¡æ¯ã€‚

ğŸ¤ è´¡çŒ®

æ¬¢è¿è´¡çŒ®ä»£ç ã€æŠ¥å‘Šé—®é¢˜æˆ–æå‡ºåŠŸèƒ½å»ºè®®ï¼

1. æäº¤Issuesï¼šæŠ¥å‘Šé—®é¢˜æˆ–åŠŸèƒ½è¯·æ±‚
2. æäº¤Pull Requestsï¼šè´¡çŒ®ä»£ç æ”¹è¿›
3. é¡¹ç›®è®¨è®ºï¼šåˆ†äº«ä½¿ç”¨ç»éªŒæˆ–å»ºè®®

â¤ï¸ æ”¯æŒ
